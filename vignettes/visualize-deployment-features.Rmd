---
title: "Visualize number of species per deployment"
author: "Damiano Oldoni"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualize number of species per deployment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette shows how to visualize number of species per deployment in a leaflet by using function  `map_dep()`.

## Setup

Load packages:

```{r load}
library(camtrapdp)
library(lubridate)
library(dplyr)
```

This load automatically a camera trap data package, `camtrapdp`, containing camera trap data about musk rat and coypu. We will use this variable from now on.

## Create map

### Basic usage

You can visualize the number of species detected by each deployment by using the function `map_dep()` with `feature` argument set to `n_species`:

```{r visualize_n_species_with_clusters_and_default_hover_col}
map_dep(deployments = camtrapdp$deployments,
        observations = camtrapdp$observations,
        feature = "n_species")
```

To visualize the number of observations, set `feature` to `n_obs`:

```{r visualize_n_obs_with_clusters_and_default_hover_col}
map_dep(deployments = camtrapdp$deployments,
        observations = camtrapdp$observations,
        feature = "n_obs")
```

### Clustering and hovering

You can specify which information you want to show while hovering with the mouse over the deployment. You can choose among all columns from deployments (see allowed fields in [camera trap data package standard documentation](https://tdwg.github.io/camtrap-dp/data/#deployments)) and `n` (number of species/observations).

Here below the lat/lon, the camera height and the tags are shown while hovering:

```{r visualize_with_clusters_spec_hover_col}
map_dep(deployments = camtrapdp$deployments,
        observations = camtrapdp$observations,
        hover_columns = c("latitude",
                          "longitude",
                          "camera_height",
                          "tags"),
        feature = "n_obs"
)
```

Deactivating both cluster mode and hovering is also possible:

```{r visualize_without_clusters}
map_dep(deployments = camtrapdp$deployments,
        observations = camtrapdp$observations,
        feature = "n_species", 
        cluster = FALSE,
        hover_column = NULL)
```

### Visualize deployments without observations

It can happen that some deployments didn't observe any animal. They are shown in the map as gray circles and a message is returned to the R console:

```{r show_deployments_without_observations}
# create df with less observations
recent_obs <- 
  camtrapdp$observations %>% 
  filter(timestamp > lubridate::as_datetime("2020-06-30"))

# create new map
map_dep(deployments = camtrapdp$deployments,
        observations = recent_obs,
        feature = "n_species")
```

### Modify circle size

You can also modify the upper and lower limit of the circle sizes by specifying `radius_range` (default:   `c(10,50`):

```{r change_size_circles}
map_dep(deployments = camtrapdp$deployments,
        observations = camtrapdp$observations,
        feature = "n_obs",
        radius_range = c(20, 150))
```

### Use absolute scale

By default the color palette is defined based on the actual number of detected species. However, sometimes can be useful to set up an absolute upper limit. This can be done by setting argument  `relative_color_scale` to  `FALSE` and specifying the upper limit in  `max_color_scale`.

Upper limit below number of detected species:

```{r low_upper_limit}
map_dep(deployments = camtrapdp$deployments,
                                 observations = camtrapdp$observations,
                                 relative_color_scale = FALSE,
                                 max_color_scale = 3)
```

Upper limit above number of detected species:

```{r high_upper_limit}
map_dep(deployments = camtrapdp$deployments,
                                 observations = camtrapdp$observations,
                                 relative_color_scale = FALSE,
                                 max_color_scale = 10)
```
