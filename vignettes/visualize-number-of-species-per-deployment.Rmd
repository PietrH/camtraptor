---
title: "Visualize number of species per deployment"
author: "Damiano Oldoni"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Visualize number of species per deployment}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette shows how to visualize number of species per deployment in a leaflet by using function  `visualize_species_per_deployment()`.

## Setup

Load packages:

```{r load}
library(camtrapdp)
library(lubridate)
library(dplyr)
```

This load automatically a camera trap data package, `camtrapdp`, containing camera trap data about musk rat and coypu. We will use this variable from now on.

## Create map

### Basic usage

You can visualize the number of species detected by each deployment by using the function `visualize_species_per_deployment()`:

```{r visualize_with_clusters_and_default_hover_col}
visualize_species_per_deployment(deployments = camtrapdp$deployments,
                                 observations = camtrapdp$observations)
```

### Clustering and hovering

You can specify which information you want to show while hovering with the mouse over the deployment. By default the number of species (`n`) is shown. Other possible values are:

- `deployment_id`
- `location_id`
- `location_name`
- `NULL` to disable hovering

Here below the column `location_name` is used instead:

```{r visualize_with_clusters_spec_hover_col}
visualize_species_per_deployment(deployments = camtrapdp$deployments,
                                 observations = camtrapdp$observations,
                                 hover_column = "location_name")
```

Deactivating both cluster mode and hovering:

```{r visualize_without_clusters}
visualize_species_per_deployment(deployments = camtrapdp$deployments,
                                 observations = camtrapdp$observations,
                                 cluster = FALSE,
                                 hover_column = NULL)
```

### Visualize deployments without observations

It can happen that some deployments didn't observe any animal. They are shown in the map as gray circles and `"NA"` is shown while hovering over:

```{r show_deployments_without_observations}
# create df with less observations
recent_obs <- 
  camtrapdp$observations %>% 
  filter(timestamp > lubridate::as_datetime("2020-06-30"))

# create new map
visualize_species_per_deployment(deployments = camtrapdp$deployments,
                                 observations = recent_obs_camtrapdp)
```

### Use absolute scale

By default the color palette is defined based on the actual number of detected species. However, sometimes can be useful to set up an absolute upper limit. This can be done by setting argument  `relative_color_scale` to  `FALSE` and specifying the upper limit in  `max_color_scale`.

Upper limit below number of detected species:

```{r low_upper_limit}
visualize_species_per_deployment(deployments = camtrapdp$deployments,
                                 observations = camtrapdp$observations,
                                 relative_color_scale = FALSE,
                                 max_color_scale = 3)
```

Upper limit above number of detected species:

```{r high_upper_limit}
visualize_species_per_deployment(deployments = camtrapdp$deployments,
                                 observations = camtrapdp$observations,
                                 relative_color_scale = FALSE,
                                 max_color_scale = 10)
```
